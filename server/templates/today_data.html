<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Today's Data Table</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background: #f0f0f0;
        }
    </style>
</head>

<body>
    <h1>Today's Data</h1>
    <h2>Daily User Log</h2>
    {% if user_log %}
    <table>
        <tr>
            {% for key in user_log.keys() %}
            <th>{{ key }}</th>
            {% endfor %}
            <th>Flag</th>
        </tr>
        <tr>
            {% for value in user_log.values() %}
            <td>{{ value }}</td>
            {% endfor %}
            <td><input type="checkbox" id="userlog-flag" onchange="setFlag('USER_LOG_FLAG', this.checked)"></td>
        </tr>
    </table>
    {% else %}
    <p>No user log for today.</p>
    {% endif %}

    <h2>Daily Bot Log</h2>
    {% if bot_log %}
    <table>
        <tr>
            {% for key in bot_log.keys() %}
            <th>{{ key }}</th>
            {% endfor %}
            <th>Flag</th>
        </tr>
        <tr>
            {% for value in bot_log.values() %}
            <td>{{ value }}</td>
            {% endfor %}
            <td><input type="checkbox" id="botlog-flag" onchange="setFlag('BOT_LOG_FLAG', this.checked)"></td>
        </tr>
    </table>
    {% else %}
    <p>No bot log for today.</p>
    {% endif %}

    <script>
        function setFlag(flag, checked) {
            if (!checked) return; // Only set flag on check
            fetch('/set_flag', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ flag: flag })
            })
                .then(res => res.json())
                .then(data => alert(data.message))
                .catch(() => alert('Error setting flag.'));
        }
    </script>
</body>

</html>